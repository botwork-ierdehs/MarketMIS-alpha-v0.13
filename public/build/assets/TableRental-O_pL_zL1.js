import{c as I,o as p,w as i,a as o,b as l,e as P,m as q,d as D,F as V,r as R,t as c,v as G,n as B,f as S,p as Y,g as N,h as F,u as A,i as L,j,l as K}from"./app-BT8JCygI.js";import{l as C,p as M}from"./pickBy-DGliTAvu.js";import{G as Q,S as X,a as E,E as U}from"./Gcash-Cj7ZBhuH.js";import{A as H}from"./AppLayout-BwNpdR10.js";import{B as J}from"./BaseTable-0ySyqEAE.js";import{P as W}from"./Pagination-Dxe08lFZ.js";import{I as Z}from"./Icons-CXmFZwmz.js";import{f as O,b as $,c as b}from"./helper-CoiklTbV.js";import{B as ee}from"./Badge-DrE7g0GE.js";import{F as te}from"./FlashMessage-SJFcFePV.js";import{S as ae}from"./SearchFilter-B7lREfu6.js";import{C as oe}from"./ConfirmationModal-DtE6bHDK.js";import{S as re}from"./SecondaryButton-_kH_xm9B.js";import{I as le}from"./InputLabel-BgI2huqF.js";import{T as se}from"./TextInput-BQ7iAE_n.js";import{I as ne}from"./InputError-CabsvCC3.js";import{L as ie}from"./LoadingButton-pngNNKcF.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Logo-DmBDO1OI.js";import"./Footer-RxzRf-uW.js";import"./Modal-DZt4hw2D.js";const ce={__name:"TableRental",props:{tableRentals:Object,filters:Object},setup(v,{expose:a}){var m,k;a();const u=N(!1),e=N(null),z=["Rental No.","Vendor","Business Name","Table","Duration","Type","Quarterly Payment","Due Date","Penalty","Current Payment","Status",""],f=v,d=F({search:(m=f==null?void 0:f.filters)==null?void 0:m.search,type:(k=f==null?void 0:f.filters)==null?void 0:k.type}),y=A({receipt:null,reference_number:"",amount:0,table_rental_id:null});L(d,C.throttle(()=>{j.get("/my-rentals/table-spaces",M(d),{preserveState:!0})},150),{deep:!0});const n=s=>{let r={color:"blue",status:"Vacant"};switch(s){case 4:r={color:"red",status:"Terminated"};break;case 3:r={color:"orange",status:"Expired"};break;case 2:r={color:"rose",status:"Rejected"};break;case 1:r={color:"green",status:"Approved"};break;default:r={color:"blue",status:"Pending"}}return r},g=[{id:1,name:"New"},{id:2,name:"Renewal"}];function t(){d.search="",d.type=null,Object.assign(d,mapValues(d,()=>null))}function T(){u.value=!1}function h(s){e.value=s,y.amount=s==null?void 0:s.quarterly_payment,y.table_rental_id=Number(s==null?void 0:s.id),u.value=!0}const _=s=>{const r=new U;r.setFontSize(18),r.text("MARKETMIS - Payment Invoice",14,20),r.setFontSize(12),r.text(`Invoice Date: ${s.date}`,14,35),r.text(`Transaction ID: ${s.transaction_id}`,14,42),r.text(`Table Renter Name: ${s.applicant_name}`,14,49),r.text(`Payment Method: ${s.payment_method}`,14,56),E(r,{startY:70,head:[["Description","Amount"]],body:[["Table Rental Payment",`${b(s.amount)}`]],theme:"grid"}),r.setFontSize(14),r.text(`Total: ${b(s.amount)}`,150,r.lastAutoTable.finalY+10),r.setFontSize(10),r.text("Thank you for your payment!",14,r.lastAutoTable.finalY+20),r.text("Generated by MarketMIS",14,r.lastAutoTable.finalY+26),r.save(`Invoice-${s.transaction_id}.pdf`)},x={isPayment:u,payee:e,headers:z,props:f,form:d,formData:y,status:n,statusOptions:g,reset:t,cancelPayment:T,payNow:h,generateInvoicePDF:_,submit:()=>{y.post(route("applications.payment"),{onSuccess:()=>{var s;_({applicant_name:O((s=e.value)==null?void 0:s.vendor),transaction_id:`TXN-${Date.now()}`,amount:e.value.quarterly_payment,date:new Date().toLocaleDateString(),payment_method:"Lizbiz Pay"}),y.reset(),u.value=!1}})},watch:L,reactive:F,ref:N,get Link(){return K},get router(){return j},get useForm(){return A},get throttle(){return C.throttle},get pickBy(){return M},get jsPDF(){return U},get autoTable(){return E},AppLayout:H,BaseTable:J,Pagination:W,Icon:Z,get formatAmount(){return b},get formatDate(){return $},get fullName(){return O},Badge:ee,FlashMessage:te,SearchFilter:ae,ConfirmationModal:oe,SecondaryButton:re,InputLabel:le,TextInput:se,InputError:ne,SingleFileUpload:X,LoadingButton:ie,Gcash:Q};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}},de={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ue={class:"flex items-center justify-between mb-6"},pe=["value"],fe={class:"px-4 py-3 capitalize text-center"},ye={class:"px-4 py-3 capitalize text-center"},_e={class:"px-4 py-3 capitalize text-center"},xe={class:"px-4 py-3 capitalize text-center"},ge={class:"px-4 py-3 capitalize text-center"},he={class:"px-4 py-3 capitalize text-center"},ve={class:"px-4 py-3 capitalize text-center"},we={class:"px-4 py-3 capitalize text-center"},ke={class:"px-4 py-3 capitalize text-center"},De={class:"px-4 py-3 capitalize text-center"},Se={key:0,class:"font-semibold text-blue-600"},Te=["disabled","onClick"],Pe={class:"px-4 py-3 capitalize text-center"},Ie={class:"px-4 py-3 capitalize"},Ne={key:0},be={class:"mt-6 flex justify-center"},ze={class:"space-y-4 p-4 text-left"},Ve={class:"flex justify-center mb-4"},Re={class:"flex flex-col md:flex-row gap-4 mt-5"},Be={class:"w-full"},Fe={class:"flex flex-col md:flex-row gap-4 mt-5"},Ae={class:"w-full"},Le={class:"w-full"},je={class:"flex justify-end space-x-3 p-4"};function Ce(v,a,u,e,z,f){return p(),I(e.AppLayout,{title:"Stalls"},{header:i(()=>[...a[5]||(a[5]=[o("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Stall ",-1)])]),default:i(()=>{var d,y;return[a[15]||(a[15]=o("h1",{class:"mb-8 text-3xl font-bold text-primary"},"Table Spaces",-1)),o("div",de,[v.$page.props.flash.success?(p(),I(e.FlashMessage,{key:0,message:v.$page.props.flash.success,type:"success"},null,8,["message"])):P("",!0),v.$page.props.flash.error?(p(),I(e.FlashMessage,{key:1,message:v.$page.props.flash.error,type:"error"},null,8,["message"])):P("",!0),o("div",ue,[l(e.SearchFilter,{modelValue:e.form.search,"onUpdate:modelValue":a[1]||(a[1]=n=>e.form.search=n),class:"mr-4 w-full max-w-md",onReset:e.reset},{default:i(()=>[a[7]||(a[7]=o("label",{class:"block text-gray-700"},"Type:",-1)),q(o("select",{"onUpdate:modelValue":a[0]||(a[0]=n=>e.form.type=n),class:"form-select mt-1 w-full"},[a[6]||(a[6]=o("option",{value:null},"All",-1)),(p(),D(V,null,R(e.statusOptions,n=>o("option",{key:n.id,value:n.id},c(n.name),9,pe)),64))],512),[[G,e.form.type]])]),_:1},8,["modelValue"]),l(e.Link,{type:"submit",class:B([{"opacity-25":e.form.processing},"bg-btn-gradient text-white font-bold uppercase px-5 py-2 rounded focus:outline-none shadow hover:bg-primary-700 transition-colors"]),disabled:e.form.processing,href:"/my-rentals/table-spaces/create"},{default:i(()=>[...a[8]||(a[8]=[S("Rent New",-1)])]),_:1},8,["class","disabled"])]),l(e.BaseTable,{headers:e.headers,data:(d=u.tableRentals)==null?void 0:d.data,class:B("center text-center sticky right-0 bg-white z-10")},{row:i(({data:n})=>{var g;return[(p(!0),D(V,null,R(n,(t,T)=>{var h,_,w,x,m;return p(),D("tr",{key:u.tableRentals.id,class:"hover:bg-gray-50"},[o("td",fe,c((h=t==null?void 0:t.permits)!=null&&h.permit_number?`${(_=t==null?void 0:t.permits)==null?void 0:_.permit_number}`:"-"),1),o("td",ye,c(`${e.fullName(t==null?void 0:t.vendor)}`),1),o("td",_e,c(t.name),1),o("td",xe,c((w=t==null?void 0:t.stalls)==null?void 0:w.name),1),o("td",ge,c(t!=null&&t.start_date&&(t!=null&&t.end_date)?`${e.formatDate(t.start_date)} - ${e.formatDate(t.end_date)}`:"-"),1),o("td",he,[l(e.Badge,{color:((x=t==null?void 0:t.permits)==null?void 0:x.type)==="new"?"green":"blue"},{default:i(()=>{var k;return[S(c((k=t==null?void 0:t.permits)==null?void 0:k.type),1)]}),_:2},1032,["color"])]),o("td",ve,c(e.formatAmount(t==null?void 0:t.quarterly_payment)),1),o("td",we,c(t!=null&&t.next_payment_due?e.formatDate(new Date(t==null?void 0:t.next_payment_due)):"N/A"),1),o("td",ke,c(e.formatAmount(t==null?void 0:t.penalty)),1),o("td",De,[(t==null?void 0:t.current_payment)==="Paid"?(p(),D("p",Se,"Paid")):P("",!0),(t==null?void 0:t.current_payment)==="Not Paid"?(p(),D("button",{key:1,disabled:((m=t==null?void 0:t.permits)==null?void 0:m.status)!==1,class:"inline-block bg-blue-600 text-white font-bold uppercase px-5 py-2 rounded focus:outline-none shadow hover:bg-primary-700 transition-colors",onClick:k=>e.payNow(t),tabindex:"-1"}," Pay Now ",8,Te)):P("",!0)]),o("td",Pe,[l(e.Badge,{color:e.status(t.permits.status).color},{default:i(()=>[S(c(e.status(t.permits.status).status),1)]),_:2},1032,["color"])]),o("td",Ie,[l(e.Link,{class:"flex items-center pr-2",href:`/my-rentals/table-spaces/${t.id}`,tabindex:"-1"},{default:i(()=>[l(e.Icon,{name:"cheveron-right",class:"block w-6 h-6 fill-primary"})]),_:1},8,["href"])])])}),128)),((g=u.tableRentals)==null?void 0:g.total)===0?(p(),D("tr",Ne,[...a[9]||(a[9]=[o("td",{class:"px-6 py-4 border-t text-center",colspan:"7"},"No records found.",-1)])])):P("",!0)]}),_:1},8,["data"])]),o("div",be,[l(e.Pagination,{links:(y=u.tableRentals)==null?void 0:y.links},null,8,["links"])]),l(e.ConfirmationModal,{show:e.isPayment,onClose:e.cancelPayment},{title:i(()=>[...a[10]||(a[10]=[S(" Pay Now ",-1)])]),content:i(()=>{var n,g,t,T,h,_,w,x;return[o("div",ze,[a[11]||(a[11]=o("p",{class:"text-gray-600"},"Please complete your payment below:",-1)),o("div",Ve,[l(e.Gcash,{class:"h-auto"})]),o("div",Re,[o("div",Be,[l(e.InputLabel,{for:"receipt",value:"Receipt",class:"mb-1 block w-full"}),l(e.SingleFileUpload,{modelValue:e.formData.receipt,"onUpdate:modelValue":a[2]||(a[2]=m=>e.formData.receipt=m),label:"Upload Official Receipt",accept:".jpg,.jpeg,.png,.pdf",class:"mt-1 block w-full",error:(g=(n=e.formData)==null?void 0:n.errors)==null?void 0:g.receipt},null,8,["modelValue","error"]),l(e.InputError,{class:"mt-2",message:(T=(t=e.formData)==null?void 0:t.errors)==null?void 0:T.receipt},null,8,["message"])])]),o("div",Fe,[o("div",Ae,[l(e.InputLabel,{for:"amount",value:"Amount"}),l(e.TextInput,{id:"amount",modelValue:e.formData.amount,"onUpdate:modelValue":a[3]||(a[3]=m=>e.formData.amount=m),type:"text",class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:"amount"},null,8,["modelValue"]),l(e.InputError,{class:"mt-2",message:(_=(h=e.formData)==null?void 0:h.errors)==null?void 0:_.amount},null,8,["message"])]),o("div",Le,[l(e.InputLabel,{for:"reference_number",value:"Reference Number"}),l(e.TextInput,{id:"reference_number",modelValue:e.formData.reference_number,"onUpdate:modelValue":a[4]||(a[4]=m=>e.formData.reference_number=m),type:"text",class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:"reference_number"},null,8,["modelValue"]),l(e.InputError,{class:"mt-2",message:(x=(w=e.formData)==null?void 0:w.errors)==null?void 0:x.reference_number},null,8,["message"])])])])]}),footer:i(()=>[o("div",je,[l(e.SecondaryButton,{onClick:e.cancelPayment},{default:i(()=>[...a[12]||(a[12]=[S(" Cancel ",-1)])]),_:1}),o("form",{onSubmit:Y(e.submit,["prevent"])},[l(e.LoadingButton,{loading:e.form.processing,class:"bg-primary ml-auto",type:"submit"},{default:i(()=>[...a[13]||(a[13]=[S(" Submit ",-1)])]),_:1},8,["loading"])],32)])]),default:i(()=>[a[14]||(a[14]=o("div",null,null,-1))]),_:1},8,["show"])]}),_:1})}const st=me(ce,[["render",Ce],["__file","TableRental.vue"]]);export{st as default};
